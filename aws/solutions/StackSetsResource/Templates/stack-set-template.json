{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Let's build a StackSet",
    "Parameters": {
        "StackSetName": {
            "Description": "[Optional] Unique name for this StackSet",
            "Type": "String"
        },
        "StackSetDescription": {
            "Description": "[Optional] Description for this StackSet",
            "Type": "String"
        },
        "TemplateURL": {
            "Description": "S3 URL for the CloudFormation template to associate with this StackSet",
            "Type": "String",
            "Default": "https://s3.us-east-2.amazonaws.com/cloudformation-pipeline/events.yaml",
            "AllowedPattern": "^https://s3(.+)\\.amazonaws.com/.+$",
            "ConstraintDescription": "must be a valid S3 URL to a template object"
        },
        "Capabilities": {
            "Description": "Include capabilities if your template contains IAM resources (see https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-iam-template.html#using-iam-capabilities)",
            "Type": "String",
            "AllowedValues": [
                "CAPABILITY_IAM",
                "CAPABILITY_NAMED_IAM",
                ""
            ],
            "Default": ""
        }
    },
    "Conditions": {
        "HasStackSetName": {
            "Fn::Not": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "StackSetName"
                        },
                        ""
                    ]
                }
            ]
        },
        "HasStackSetDescription": {
            "Fn::Not": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "StackSetDescription"
                        },
                        ""
                    ]
                }
            ]
        },
        "HasCapabilities": {
            "Fn::Not": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "Capabilities"
                        },
                        ""
                    ]
                }
            ]
        }
    },
    "Resources": {
        "StackSet": {
            "Type": "Custom::StackSet",
            "Properties": {
                "ServiceToken": {
                    "Fn::ImportValue": "StackSetCustomResource"
                },
                "loglevel": "debug",
                "StackSetName": {
                    "Fn::If": [
                        "HasStackSetName",
                        {
                            "Ref": "StackSetName"
                        },
                        {
                            "Ref": "AWS::NoValue"
                        }
                    ]
                },
                "StackSetDescription": {
                    "Fn::If": [
                        "HasStackSetDescription",
                        {
                            "Ref": "StackSetDescription"
                        },
                        {
                            "Ref": "AWS::NoValue"
                        }
                    ]
                },
                "TemplateURL": {
                    "Ref": "TemplateURL"
                },
                "Capabilities": {
                    "Fn::If": [
                        "HasCapabilities",
                        [
                            {
                                "Ref": "Capabilities"
                            }
                        ],
                        [
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    ]
                },
                "OperationPreferences": {
                    "RegionOrder": {
                        "Ref": "AWS::NoValue"
                    },
                    "FailureToleranceCount": 0,
                    "MaxConcurrentCount": 3
                },
                "Parameters": [
                    {
                        "ReadCapacity": 20
                    },
                    {
                        "WriteCapacity": 20
                    }
                ],
                "Tags": [
                    {
                        "Environment": "Testing"
                    },
                    {
                        "Creator": "Chuck"
                    }
                ],
                "StackInstances": [
                    {
                        "Regions": [
                            "us-east-2"
                        ],
                        "Accounts": [
                            225704381548
                        ]
                    },
                    {
                        "Regions": [
                            "us-east-2",
                            "us-west-2",
                            "eu-west-2"
                        ],
                        "Accounts": [
                            888049286042
                        ],
                        "ParameterOverrides": [
                            {
                                "ReadCapacity": 50
                            },
                            {
                                "WriteCapacity": 50
                            }
                        ]
                    }
                ]
            }
        }
    }
}
